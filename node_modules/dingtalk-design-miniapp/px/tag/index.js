"use strict";

Component({
  mixins: [],
  data: {
    $uiName: 'tag',
    checked: false,
    closed: false
  },
  props: {
    style: '',
    className: '',
    text: '',
    icon: '',
    type: 'blue',
    // blue, red, green, orange, default, water
    size: 'small',
    // large, small
    checked: false,
    autoChecked: false,
    // 是否响应点击选中事件
    closable: false,
    data: null,
    onTap: null,
    onChange: null,
    onClose: null
  },
  didMount: function didMount() {
    this.setData({
      checked: this.props.checked
    });
    this._updateDataSet();
  },
  didUpdate: function didUpdate(prevProps) {
    if (prevProps.checked !== this.props.checked) {
      this.setData({
        checked: this.props.checked
      });
    }
    this._updateDataSet();
  },
  didUnmount: function didUnmount() {},
  methods: {
    _updateDataSet: function _updateDataSet() {
      this.dataset = {};
      for (var key in this.props) {
        if (/data-/gi.test(key)) {
          this.dataset[key.replace(/data-/gi, '')] = this.props[key];
        }
      }
    },
    onItemTap: function onItemTap(e) {
      var _this = this;
      var _this$props = this.props,
        onTap = _this$props.onTap,
        autoChecked = _this$props.autoChecked,
        onDmTap = _this$props.onDmTap,
        onDmChange = _this$props.onDmChange,
        onChange = _this$props.onChange,
        data = _this$props.data;
      if (autoChecked && !this.data.closed) {
        this.setData({
          checked: !this.data.checked
        }, function () {
          if (onChange) {
            onChange(_this.data.checked, {
              target: {
                dataset: _this.dataset
              }
            });
          } else if (onDmChange) {
            onDmChange(_this.data.checked, data);
          }
        });
      }
      if (onTap) {
        onTap({
          target: {
            dataset: this.dataset
          }
        });
      } else if (onDmTap) {
        onDmTap(e, this);
      }
    },
    onItemClose: function onItemClose() {
      var _this2 = this;
      var _this$props2 = this.props,
        closable = _this$props2.closable,
        autoChecked = _this$props2.autoChecked,
        data = _this$props2.data,
        onChange = _this$props2.onChange,
        onDmChange = _this$props2.onDmChange,
        onClose = _this$props2.onClose,
        onDmClose = _this$props2.onDmClose;
      if (closable) {
        this.setData({
          closed: true
        }, function () {
          if (autoChecked) {
            if (onChange) {
              onChange(false, {
                target: {
                  dataset: _this2.dataset
                }
              });
            } else {
              onDmChange(false, data);
            }
          }
          if (onClose) {
            onClose({
              target: {
                dataset: _this2.dataset
              }
            });
          } else if (onDmClose) {
            onDmClose(data);
          }
        });
      }
    }
  }
});